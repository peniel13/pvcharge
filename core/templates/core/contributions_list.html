{% extends "base.html" %}
{% load custom_filters %}

{% block content %}

<div class="container mx-auto px-4 py-8">
  <h2 class="text-2xl font-bold mb-4 text-gray-800">
    Liste des Contributeurs pour : <span class="text-purple-700">{{ projet.titre }}</span>
  </h2>
  <div class="mb-6 p-4 bg-gray-100 rounded-lg shadow text-sm text-gray-700">
    <p><strong>Montant objectif :</strong> {{ projet.montant_objectif|floatformat:2 }} FC</p>
    <p><strong>Montant r√©colt√© :</strong> {{ projet.montant_recolte_effectif }} FC</p>
    <p><strong>Progression :</strong> 
        {% if projet.montant_objectif > 0 %}
        {{ projet.montant_recolte_effectif|percent:projet.montant_objectif|floatformat:2 }} %
        
        {% else %}
          N/A
        {% endif %}
      </p>
      <!-- ‚úÖ Barre de progression graphique -->
{% if projet.montant_objectif > 0 %}
{% with pourcentage=projet.montant_recolte_effectif|percent:projet.montant_objectif %}

  <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden mt-2">
    <div class="bg-purple-600 h-full text-xs text-white text-center" style="width: {{ pourcentage }}%">
      {{ pourcentage }}%
    </div>
  </div>
{% endwith %}
{% else %}
<p class="text-sm text-gray-500 italic">Objectif non d√©fini</p>
{% endif %}
  </div>
  <form method="get" class="mb-6">
    <div class="flex items-center gap-4">
      <input 
        type="text" 
        name="q" 
        value="{{ search_query }}" 
        placeholder="Rechercher un contributeur..." 
        class="w-full md:w-1/3 px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-600"
      >
      <button type="submit" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
        Rechercher
      </button>
    </div>
  </form>
  
  {% if contributions %}
    <div id="table" class="overflow-x-auto">
      <table class="min-w-full bg-white rounded shadow-md">
        <thead class="bg-purple-600 text-white">
          <tr>
            <th class="py-3 px-4 text-left">Contributeur</th>
            <th class="py-3 px-4 text-left">Montant (FC)</th>
            <th class="py-3 px-4 text-left">T√©l√©phone</th>
            <th class="py-3 px-4 text-left">Ville</th>
            <th class="py-3 px-4 text-left">Commune</th>
            <th class="py-3 px-4 text-left">Contr√©e</th>
            <th class="py-3 px-4 text-left">Date</th>
          </tr>
        </thead>
        <tbody>
          {% for contribution in contributions %}
            <tr class="border-b hover:bg-gray-50">
              <td class="py-2 px-4">{{ contribution.nom_contributeur }}</td>
              <td class="py-2 px-4 text-green-700 font-semibold">{{ contribution.montant }}</td>
              <td class="py-2 px-4">{{ contribution.phone_number }}</td>
              <td class="py-2 px-4">
                {% if contribution.ville %}
                  {{ contribution.ville.name }}
                {% endif %}
              </td>
              <td class="py-2 px-4">
                {% if contribution.commune %}
                  {{ contribution.commune.name }}
                {% endif %}
              </td>
              <td class="py-2 px-4">
                {% if contribution.contree %}
                  {{ contribution.contree.name }}
                {% endif %}
              </td>
              <td class="py-2 px-4">{{ contribution.date_contribution|date:"d M Y H:i" }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <!-- üîÅ Pagination -->
{% if contributions.has_other_pages %}
<div class="mt-8">
  <nav aria-label="Pagination des contributions" class="flex justify-center">
    <ul class="flex space-x-4">
      {% if contributions.has_previous %}
        <li>
          <a href="?page=1#table"
             class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
            &laquo; Premi√®re
          </a>
        </li>
        <li>
          <a href="?page={{ contributions.previous_page_number }}#table"
             class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
            &lt;
          </a>
        </li>
      {% endif %}

      <li>
        <span class="px-4 py-2 bg-purple-600 text-white rounded-lg">
          {{ contributions.number }}
        </span>
      </li>

      {% if contributions.number < contributions.paginator.num_pages %}
        <li>
          <a href="?page={{ contributions.paginator.num_pages }}#table"
             class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-purple-600 hover:text-white">
            {{ contributions.paginator.num_pages }}
          </a>
        </li>
      {% endif %}

      {% if contributions.has_next %}
        <li>
          <a href="?page={{ contributions.next_page_number }}#table"
             class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
            &gt;
          </a>
        </li>
        <li>
          <a href="?page={{ contributions.paginator.num_pages }}#table"
             class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
            Derni√®re &raquo;
          </a>
        </li>
      {% endif %}
    </ul>
  </nav>
</div>
{% endif %}

  {% else %}
    <p class="text-gray-600 mt-4">Aucune contribution active pour ce projet.</p>
  {% endif %}
</div>

{% endblock %}

